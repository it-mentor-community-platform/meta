# Окружения и профили

## Локальное окружение

Локальное окружение представляет собой Docker Compose стек из контейнеров, который каждый разработчик запускает локально.

Суть локального стека - запускать окружение, в контексте которого можно вести работу над своей текущей задачей.

Из чего состоит стек:
- Контейнер Postgres
- По контейнеру для каждого разрабатываемого нами сервиса

Детали:
- Порты всех сервисов прокидываются наружу для доступа к ним извне Compose стека в целях разработки и тестирования
- Сервисы, запущенные внутри контейнеров, используют профиль `local-stack`, и обращаются к другим сервисам по их именам (пример - если сервис Postgres называется `db`, другие сервисы будут обращаться к нему по адресу `db:5432`)
- Сервисы, запущенные в IDE, используют профиль `ide`, и обращаются к другим сервисам через прокинутые на localhost порты. Пример - `localhost:5432` для подключения к Postgres
- Пароли хранятся в Compose файле в открытом виде и являются максимально простыми. Пример - `root`/`password` для доступа к Postgres

## Staging окружение

Staging окружение обеспечивает возможность функционально тестировать приложение в доступном всей команде едином месте, демонстрировать новый функционал.

Технологии:
- Kubernetes как оркестратор
- Selectel Cloud в качестве облачного провайдера
- Managed Postgres в качестве базы данных
- В дополнение к списку разрабатываемых нами сервисов экосистема приложения включает в себя инструменты мониторинга, централизованного логирования, ротации TLS/HTTPS сертификатов

Детали:
- Наружу прокидываются только те сервисы, которые необходимы для взаимодействия с ними со стороны фронтенд клиентов. Остальные сервисы приватно доступны только изнутри кластера
- Сервисы, запущенные в Kubernetes подах используют профиль `staging`
- Пароли хранятся в закрытом виде и недоступны разработчикам

---

TODO prod окружение
